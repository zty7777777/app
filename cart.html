<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">购物车</h1>
		</header>
		<div class="mui-content">
			<div class="mui-card">
				<ul class="mui-table-view">	
					 <li class="mui-table-view-cell">
							<font>名称</font> &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;        
							<font>价格(￥)</font>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  
							<font>购买数量</font>
						</li>
					 <li class="mui-table-view-cell" id="cartshow">
						<font class="goods_name">iphone 8 plus</font> &nbsp;&nbsp;    
						<font color="red" class="goods_price">8999.00</font>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						<font  class="goods_num">1</font>
					</li>
				
					<!-- <li class="mui-table-view-cell mui-checkbox mui-left">
						<input name="checkbox" type="checkbox">Item 7
					</li>
					<li class="mui-table-view-cell mui-checkbox mui-left">
						<input name="checkbox" type="checkbox">Item 8
					</li> -->
					<li align="right">
						<button type="button" class="mui-btn mui-btn-primary" style="align:right;" id="pay">
							去结算
						</button>
					</li>
				</ul>
			</div>	
		</div>
		<script src="js/jquery-3.2.1.min.js"></script>
		<script src="js/mui.js"></script>
		<script type="text/javascript">
			mui.init()
			$(function(){
				//加载购物车商品数据
					 mui.ajax('http://second.zty77.com/cartinfo',{
						data:{
							id:1
						},
						dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						success:function(msg){
							var _li='';
							for(var i in msg) {
								_li +="<li class='mui-table-view-cell cartshow'>"+
									"<font class='goods_name'>"+msg[i]['goods_name']+"</font>"+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+
									"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+
									"<font color='red' class='goods_price'>"+msg[i]['goods_price']+"</font>"+"&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;"+ 
									"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+ 
									"<font  class='buy_num'>"+msg[i]['buy_num']+"</font>" +
									"</li>"
							}
							// alert(_tr);
							$('#cartshow').html(_li)
						},
						error:function(xhr,type,errorThrown){
							alert(type)
						}
					}) ; 
	
				
				//去结算
				$('#pay').click(function(){
					//循环获取商品价格
					total=0;
					num=0;
					$('.cartshow').each(function(index){
						
							var subtotal = $(this).find("font[class='goods_price']").text();
							var n = parseInt($(this).find("font[class='buy_num']").text());
							subtotal = parseInt(subtotal)*n//总计
							total+=subtotal;

					});
					//alert(total);
					mui.ajax('http://second.zty77.com/order',{
									data:{
										uid:1,
										order_amount:total
									},
									async:true,
									type:'post',
									dataType:'json',
									timeout:10000,
									success:function(data){
										//请求成功
										mui.alert(data.msg,'进入订单列表','确定',function (e) {
										   e.index
										},'div')
										window.location.replace('orderlist.html');
										
									},
									error:function(xhr, type, errorThrown){
										//请求失败
										mui.alert('请求服务器失败，请重试','title','确定',function (e) {
										   e.index
										},'div')
								 }
					});  
				})
			})
		</script>
	</body>

</html>
